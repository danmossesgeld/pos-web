import{s as gt,n as ot,r as mt}from"../chunks/scheduler.BELo7BN7.js";import{S as xt,i as bt,e as f,s as N,t as H,c as m,a as C,f as O,k as J,d as w,b as R,l as p,g as _t,h as e,m as rt,n as G,j as $,o as wt}from"../chunks/index.BanRfVMS.js";import{e as ct}from"../chunks/each.D6YF6ztN.js";import{d as X}from"../chunks/firebase.client.Bnf0kfj9.js";import{e as it,c as Z,q as dt,w as ut,a as ht,u as Tt,i as Dt}from"../chunks/index.esm2017.C5xuyXIG.js";function pt(s,a,l){const n=s.slice();return n[2]=a[l].pID,n[18]=a[l].name,n[19]=a[l].srp,n[20]=a[l].quantity,n[21]=a[l].total,n[23]=l,n}function ft(s){let a,l,n=s[2]+"",r,D,B,T=s[18]+"",x,I,k,L=s[19]?`$${s[19].toFixed(2)}`:"$0.00",P,E,b,y,A="-",z,q,F=s[20]+"",U,t,u,h="+",v,o,d=s[21]?`$${s[21].toFixed(2)}`:"$0.00",c,g,i,S,V="Delete",M,Q,Y;function K(){return s[10](s[23])}function yt(){return s[11](s[23])}function vt(){return s[12](s[23])}return{c(){a=f("tr"),l=f("td"),r=H(n),D=N(),B=f("td"),x=H(T),I=N(),k=f("td"),P=H(L),E=N(),b=f("td"),y=f("button"),y.textContent=A,z=N(),q=f("span"),U=H(F),t=N(),u=f("button"),u.textContent=h,v=N(),o=f("td"),c=H(d),g=N(),i=f("td"),S=f("button"),S.textContent=V,M=N(),this.h()},l(j){a=m(j,"TR",{class:!0});var _=C(a);l=m(_,"TD",{class:!0});var tt=C(l);r=R(tt,n),tt.forEach(w),D=O(_),B=m(_,"TD",{class:!0});var et=C(B);x=R(et,T),et.forEach(w),I=O(_),k=m(_,"TD",{class:!0});var at=C(k);P=R(at,L),at.forEach(w),E=O(_),b=m(_,"TD",{class:!0});var W=C(b);y=m(W,"BUTTON",{class:!0,"data-svelte-h":!0}),J(y)!=="svelte-z88q22"&&(y.textContent=A),z=O(W),q=m(W,"SPAN",{class:!0});var st=C(q);U=R(st,F),st.forEach(w),t=O(W),u=m(W,"BUTTON",{class:!0,"data-svelte-h":!0}),J(u)!=="svelte-wkoovt"&&(u.textContent=h),W.forEach(w),v=O(_),o=m(_,"TD",{class:!0});var nt=C(o);c=R(nt,d),nt.forEach(w),g=O(_),i=m(_,"TD",{class:!0});var lt=C(i);S=m(lt,"BUTTON",{class:!0,"data-svelte-h":!0}),J(S)!=="svelte-zki8u3"&&(S.textContent=V),lt.forEach(w),M=O(_),_.forEach(w),this.h()},h(){p(l,"class","px-4 py-2"),p(B,"class","px-4 py-2"),p(k,"class","px-4 py-2"),p(y,"class","bg-yellow-500 text-white px-4 py-2 rounded-md"),p(q,"class","mx-2"),p(u,"class","bg-yellow-500 text-white px-4 py-2 rounded-md"),p(b,"class","px-4 py-2"),p(o,"class","px-4 py-2"),p(S,"class","bg-red-500 text-white px-4 py-2 rounded-md"),p(i,"class","px-4 py-2"),p(a,"class","border-b")},m(j,_){_t(j,a,_),e(a,l),e(l,r),e(a,D),e(a,B),e(B,x),e(a,I),e(a,k),e(k,P),e(a,E),e(a,b),e(b,y),e(b,z),e(b,q),e(q,U),e(b,t),e(b,u),e(a,v),e(a,o),e(o,c),e(a,g),e(a,i),e(i,S),e(a,M),Q||(Y=[G(y,"click",K),G(u,"click",yt),G(S,"click",vt)],Q=!0)},p(j,_){s=j,_&1&&n!==(n=s[2]+"")&&$(r,n),_&1&&T!==(T=s[18]+"")&&$(x,T),_&1&&L!==(L=s[19]?`$${s[19].toFixed(2)}`:"$0.00")&&$(P,L),_&1&&F!==(F=s[20]+"")&&$(U,F),_&1&&d!==(d=s[21]?`$${s[21].toFixed(2)}`:"$0.00")&&$(c,d)},d(j){j&&w(a),Q=!1,mt(Y)}}}function It(s){let a,l,n,r,D,B="Open Camera Barcode Scanner",T,x,I,k,L='<tr class="bg-gray-200"><th class="px-4 py-2 text-left">Product ID</th> <th class="px-4 py-2 text-left">Name</th> <th class="px-4 py-2 text-left">SRP</th> <th class="px-4 py-2 text-left">Quantity</th> <th class="px-4 py-2 text-left">Total</th> <th class="px-4 py-2 text-left">Actions</th></tr>',P,E,b,y,A,z,q=s[1].toFixed(2)+"",F,U,t,u="Checkout",h,v,o=ct(s[0]),d=[];for(let c=0;c<o.length;c+=1)d[c]=ft(pt(s,o,c));return{c(){a=f("div"),l=f("div"),n=f("input"),r=N(),D=f("button"),D.textContent=B,T=N(),x=f("div"),I=f("table"),k=f("thead"),k.innerHTML=L,P=N(),E=f("tbody");for(let c=0;c<d.length;c+=1)d[c].c();b=N(),y=f("div"),A=f("span"),z=H("Grand Total: $"),F=H(q),U=N(),t=f("button"),t.textContent=u,this.h()},l(c){a=m(c,"DIV",{class:!0});var g=C(a);l=m(g,"DIV",{class:!0});var i=C(l);n=m(i,"INPUT",{id:!0,type:!0,class:!0,placeholder:!0}),r=O(i),D=m(i,"BUTTON",{class:!0,"data-svelte-h":!0}),J(D)!=="svelte-koiqqx"&&(D.textContent=B),i.forEach(w),T=O(g),x=m(g,"DIV",{class:!0});var S=C(x);I=m(S,"TABLE",{id:!0,class:!0});var V=C(I);k=m(V,"THEAD",{"data-svelte-h":!0}),J(k)!=="svelte-iziud6"&&(k.innerHTML=L),P=O(V),E=m(V,"TBODY",{});var M=C(E);for(let K=0;K<d.length;K+=1)d[K].l(M);M.forEach(w),V.forEach(w),S.forEach(w),b=O(g),y=m(g,"DIV",{class:!0});var Q=C(y);A=m(Q,"SPAN",{class:!0});var Y=C(A);z=R(Y,"Grand Total: $"),F=R(Y,q),Y.forEach(w),U=O(Q),t=m(Q,"BUTTON",{class:!0,"data-svelte-h":!0}),J(t)!=="svelte-11bb1v3"&&(t.textContent=u),Q.forEach(w),g.forEach(w),this.h()},h(){p(n,"id","pID"),p(n,"type","text"),p(n,"class","w-1/3 px-4 py-2 text-sm border rounded-md"),p(n,"placeholder","Scan product ID here.."),p(D,"class","bg-blue-500 text-white px-6 py-2 rounded-md ml-4"),p(l,"class","flex items-center mb-4"),p(I,"id","cartTable"),p(I,"class","min-w-full table-auto"),p(x,"class","flex-grow overflow-auto max-h-[calc(100vh-200px)]"),p(A,"class","font-semibold text-lg"),p(t,"class","bg-green-500 text-white px-6 py-2 rounded-md"),p(y,"class","absolute bottom-6 right-6 flex items-center justify-between w-64"),p(a,"class","flex flex-col p-6 bg-gray-100 rounded-lg shadow-lg h-screen")},m(c,g){_t(c,a,g),e(a,l),e(l,n),rt(n,s[2]),e(l,r),e(l,D),e(a,T),e(a,x),e(x,I),e(I,k),e(I,P),e(I,E);for(let i=0;i<d.length;i+=1)d[i]&&d[i].m(E,null);e(a,b),e(a,y),e(y,A),e(A,z),e(A,F),e(y,U),e(y,t),h||(v=[G(n,"input",s[8]),G(n,"keydown",s[9]),G(D,"click",s[3]),G(t,"click",s[7])],h=!0)},p(c,[g]){if(g&4&&n.value!==c[2]&&rt(n,c[2]),g&97){o=ct(c[0]);let i;for(i=0;i<o.length;i+=1){const S=pt(c,o,i);d[i]?d[i].p(S,g):(d[i]=ft(S),d[i].c(),d[i].m(E,null))}for(;i<d.length;i+=1)d[i].d(1);d.length=o.length}g&2&&q!==(q=c[1].toFixed(2)+"")&&$(F,q)},i:ot,o:ot,d(c){c&&w(a),wt(d,c),h=!1,mt(v)}}}function kt(s,a,l){let n="",r=[],D=0,B=!1,T=null,x=null;const I=()=>{const t=localStorage.getItem("scannedBarcode");t&&(l(2,n=t),P(),localStorage.removeItem("scannedBarcode"))},k=()=>{B?(T&&!T.closed&&T.close(),B=!1,localStorage.removeItem("scannedBarcode"),x&&(window.removeEventListener("storage",x),x=null)):(!T||T.closed)&&(T=window.open("/user/pos/scanner","scanner","width=800,height=600"),B=!0,x=()=>I(),window.addEventListener("storage",x))},L=async t=>{const u=Z(X,"Inventory"),h=dt(u,ut("pID","==",t));try{const v=await ht(h);if(v.empty)return alert("Item not found."),t="",null;const o=v.docs[0].data();return{name:o.name,srp:o.srp,cost:o.cost}}catch(v){return console.error("Error fetching item details:",v),alert("There was an error fetching the item details."),null}},P=async()=>{if(!n){alert("Please enter a valid product ID.");return}const t=await L(n);if(!t)return;const{name:u,srp:h}=t,v=r.findIndex(o=>o.pID===n);v!==-1?(l(0,r[v].quantity+=1,r),l(0,r[v].total=r[v].srp*r[v].quantity,r)):l(0,r=[...r,{pID:n,name:u,srp:h,quantity:1,total:h}]),l(2,n="")},E=(t,u)=>{const h=r[t];h.quantity+=u,h.quantity<1&&(h.quantity=1),h.total=h.srp*h.quantity,l(0,r=[...r])},b=t=>{l(0,r=r.filter((u,h)=>h!==t))},y=async()=>{if(r.length===0){alert("Your cart is empty!");return}try{const t=`TID${Date.now()}`;let u=0,h=0;for(const o of r){const d=await L(o.pID);d&&(u+=d.cost*o.quantity,h+=o.srp*o.quantity)}const v=h-u;await it(Z(X,"Transactions"),{id:t,DateTime:new Date().toISOString(),TotalCost:u,TotalSrp:h,TotalIncome:v});for(const o of r){await it(Z(X,"TransactionItems"),{id:t,pID:o.pID,name:o.name,quantity:o.quantity,srp:o.srp,cost:u/h});const d=dt(Z(X,"Inventory"),ut("pID","==",o.pID)),c=await ht(d);if(!c.empty){const g=c.docs[0].ref;await Tt(g,{stocks:Dt(-o.quantity)})}}alert("Transaction finalized successfully!"),l(0,r=[])}catch(t){console.error("Error during checkout:",t),alert("There was an error during the checkout process.")}};function A(){n=this.value,l(2,n)}const z=t=>{t.key==="Enter"&&P()},q=t=>E(t,-1),F=t=>E(t,1),U=t=>b(t);return s.$$.update=()=>{s.$$.dirty&1&&l(1,D=r.reduce((t,u)=>t+u.total,0))},[r,D,n,k,P,E,b,y,A,z,q,F,U]}class Nt extends xt{constructor(a){super(),bt(this,a,kt,It,gt,{})}}export{Nt as component};
